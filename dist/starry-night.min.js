class Star{constructor(t){const i=Math.floor(Math.random()*Star.types),o=Math.floor(Math.random()*Star.colors);this.imgColor=Star.spriteReplacements[o],this.x=Math.random(),void 0===t?(this.toBeReplaced=!0,this.y=Math.random()):(this.y=t+Math.random()*Star.stopRenderingThreshold-Star.stopRenderingThreshold/2,this.toBeReplaced=!1),this.z=1+5*Math.random(),this.spriteX=i*Star.imgSize,this.spriteY=o*Star.imgSize,this.brightness=0,this.noiseX=10*Math.random(),this.noiseSpeed=.01+.035*Math.random(),this.displayDimensions=Star.imgSize/this.z}show(t,i){this.y<-10||this.y+10>windowHeight||(this.displayDimensions>=Star.imageThreshold?(tint(255,this.brightness),image(Star.sprite,this.x*t,this.y*i,this.displayDimensions,this.displayDimensions,this.spriteX,this.spriteY,Star.imgSize,Star.imgSize)):(fill(this.imgColor[0],this.imgColor[1],this.imgColor[2],this.brightness),noStroke(),this.displayDimensions>=Star.ellipseThreshold?ellipse(this.x*t,this.y*i,this.displayDimensions,this.displayDimensions):this.displayDimensions>=Star.rectangleThreshold?rect(this.x*t,this.y*i,this.displayDimensions,this.displayDimensions):(stroke(this.imgColor[0],this.imgColor[1],this.imgColor[2],this.brightness),point(this.x*t,this.y*i))))}update(){this.noiseX+=this.noiseSpeed,this.brightness=255*noise(this.noiseX)}updatePositionPostScroll(t){this.y-=t*Star.parallaxMultiplier/this.z,this.toBeReplaced&&(this.y<Star.SCREEN_TOP?(Star.DEBUG&&console.info("adding new star at bottom"),Star.population.push(new Star(Star.SCREEN_BOTTOM)),this.toBeReplaced=!1):this.y>Star.SCREEN_BOTTOM&&(Star.DEBUG&&console.info("adding new star at top"),Star.population.push(new Star(Star.SCREEN_TOP)),this.toBeReplaced=!1))}}let canvas,documentScrollPosition;function preload(){Star.sprite=loadImage(Star.spritePath)}function setup(){(canvas=createCanvas(windowWidth,windowHeight)).elt.style.zIndex="-1",canvas.elt.style.position="fixed",canvas.elt.style.left="0",canvas.elt.style.top="0",ellipseMode(CORNER),Star.sprite.loadPixels(),Star.types=Math.floor(Star.sprite.width/Star.imgSize),Star.colors=Math.floor(Star.sprite.height/Star.imgSize),Star.populationSize=windowWidth*windowHeight/14e3;for(let t=0;t<Star.populationSize;t++)Star.population.push(new Star);documentScrollPosition=getScrollPosition(),window.onscroll=handleStarryNightScroll,frameRate(35)}function draw(){const t=windowWidth,i=windowHeight;background(Star.bgColor[0],Star.bgColor[1],Star.bgColor[2]);for(let o=0;o<Star.population.length;o++)Star.population[o].update(),Star.population[o].show(t,i);Star.DEBUG&&(fill(255),textSize(32),text(Math.round(frameRate()),10,50))}function windowResized(){resizeCanvas(windowWidth,windowHeight)}function getScrollPosition(){return document.documentElement.scrollTop||document.body.scrollTop}function handleStarryNightScroll(){const t=getScrollPosition(),i=(t-documentScrollPosition)/windowHeight;for(let t=0;t<Star.population.length;t++)Star.population[t].updatePositionPostScroll(i);documentScrollPosition=t}Star.imgSize=12,Star.imageThreshold=4.5,Star.ellipseThreshold=2.2,Star.rectangleThreshold=1.5,Star.stopRenderingThreshold=.02,Star.spritePath="stars-sprite-"+Star.imgSize+".png",Star.sprite,Star.types,Star.colors,Star.spriteReplacements=[[232,175,4],[198,125,184],[64,214,51],[74,97,191],[214,164,64],[224,74,4]],Star.bgColor=[22,26,29],Star.parallaxMultiplier=.2,Star.populationSize,Star.population=[],Star.DEBUG=!1,Star.SCREEN_BOTTOM=1+Star.stopRenderingThreshold,Star.SCREEN_TOP=-Star.stopRenderingThreshold;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIl9zdGFyLmpzIiwic3RhcnJ5LW5pZ2h0LmpzIl0sIm5hbWVzIjpbIlN0YXIiLCJbb2JqZWN0IE9iamVjdF0iLCJoZWlnaHQiLCJ0eXBlIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwidHlwZXMiLCJjb2xvciIsImNvbG9ycyIsInRoaXMiLCJpbWdDb2xvciIsInNwcml0ZVJlcGxhY2VtZW50cyIsIngiLCJ0b0JlUmVwbGFjZWQiLCJ5Iiwic3RvcFJlbmRlcmluZ1RocmVzaG9sZCIsInoiLCJzcHJpdGVYIiwiaW1nU2l6ZSIsInNwcml0ZVkiLCJicmlnaHRuZXNzIiwibm9pc2VYIiwibm9pc2VTcGVlZCIsImRpc3BsYXlEaW1lbnNpb25zIiwidyIsImgiLCJ3aW5kb3dIZWlnaHQiLCJpbWFnZVRocmVzaG9sZCIsInRpbnQiLCJpbWFnZSIsInNwcml0ZSIsImZpbGwiLCJub1N0cm9rZSIsImVsbGlwc2VUaHJlc2hvbGQiLCJlbGxpcHNlIiwicmVjdGFuZ2xlVGhyZXNob2xkIiwicmVjdCIsInN0cm9rZSIsInBvaW50Iiwibm9pc2UiLCJyZWxhdGl2ZUluY3JlYXNlIiwicGFyYWxsYXhNdWx0aXBsaWVyIiwiU0NSRUVOX1RPUCIsIkRFQlVHIiwiY29uc29sZSIsImluZm8iLCJwb3B1bGF0aW9uIiwicHVzaCIsIlNDUkVFTl9CT1RUT00iLCJjYW52YXMiLCJkb2N1bWVudFNjcm9sbFBvc2l0aW9uIiwicHJlbG9hZCIsImxvYWRJbWFnZSIsInNwcml0ZVBhdGgiLCJzZXR1cCIsImNyZWF0ZUNhbnZhcyIsIndpbmRvd1dpZHRoIiwiZWx0Iiwic3R5bGUiLCJ6SW5kZXgiLCJwb3NpdGlvbiIsImxlZnQiLCJ0b3AiLCJlbGxpcHNlTW9kZSIsIkNPUk5FUiIsImxvYWRQaXhlbHMiLCJ3aWR0aCIsInBvcHVsYXRpb25TaXplIiwiaSIsImdldFNjcm9sbFBvc2l0aW9uIiwid2luZG93Iiwib25zY3JvbGwiLCJoYW5kbGVTdGFycnlOaWdodFNjcm9sbCIsImZyYW1lUmF0ZSIsImRyYXciLCJiYWNrZ3JvdW5kIiwiYmdDb2xvciIsImxlbmd0aCIsInVwZGF0ZSIsInNob3ciLCJ0ZXh0U2l6ZSIsInRleHQiLCJyb3VuZCIsIndpbmRvd1Jlc2l6ZWQiLCJyZXNpemVDYW52YXMiLCJkb2N1bWVudCIsImRvY3VtZW50RWxlbWVudCIsInNjcm9sbFRvcCIsImJvZHkiLCJuZXdTY3JvbGxQb3NpdGlvbiIsInVwZGF0ZVBvc2l0aW9uUG9zdFNjcm9sbCJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBQUEsS0FDQUMsWUFBQUMsR0FDQSxNQUFBQyxFQUFBQyxLQUFBQyxNQUFBRCxLQUFBRSxTQUFBTixLQUFBTyxPQUNBQyxFQUFBSixLQUFBQyxNQUFBRCxLQUFBRSxTQUFBTixLQUFBUyxRQUNBQyxLQUFBQyxTQUFBWCxLQUFBWSxtQkFBQUosR0FDQUUsS0FBQUcsRUFBQVQsS0FBQUUsY0FDQSxJQUFBSixHQUNBUSxLQUFBSSxjQUFBLEVBQ0FKLEtBQUFLLEVBQUFYLEtBQUFFLFdBRUFJLEtBQUFLLEVBQUFiLEVBQUFFLEtBQUFFLFNBQ0FOLEtBQUFnQix1QkFBQWhCLEtBQUFnQix1QkFBQSxFQUNBTixLQUFBSSxjQUFBLEdBRUFKLEtBQUFPLEVBQUEsRUFBQSxFQUFBYixLQUFBRSxTQUNBSSxLQUFBUSxRQUFBZixFQUFBSCxLQUFBbUIsUUFDQVQsS0FBQVUsUUFBQVosRUFBQVIsS0FBQW1CLFFBQ0FULEtBQUFXLFdBQUEsRUFFQVgsS0FBQVksT0FBQSxHQUFBbEIsS0FBQUUsU0FDQUksS0FBQWEsV0FBQSxJQUFBLEtBQUFuQixLQUFBRSxTQUNBSSxLQUFBYyxrQkFBQXhCLEtBQUFtQixRQUFBVCxLQUFBTyxFQUdBaEIsS0FBQXdCLEVBQUFDLEdBQ0FoQixLQUFBSyxHQUFBLElBQUFMLEtBQUFLLEVBQUEsR0FBQVksZUFFQWpCLEtBQUFjLG1CQUFBeEIsS0FBQTRCLGdCQUVBQyxLQUFBLElBQUFuQixLQUFBVyxZQUNBUyxNQUFBOUIsS0FBQStCLE9BQ0FyQixLQUFBRyxFQUFBWSxFQUFBZixL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cEIsb0JBQ0E3QixHQUFBaUQsRUFBQXZDLHdCQUFBeEIsYUFDQSxJQUFBLElBQUEwQyxFQUFBLEVBQUFBLEVBQUFyRSxLQUFBK0MsV0FBQStCLE9BQUFULElBQ0FyRSxLQUFBK0MsV0FBQXNCLEdBQUFzQix5QkFBQWxELEdBRUFVLHVCQUFBdUMsRURvQkExRixLQUFBbUIsUUFBQSxHQUVBbkIsS0FBQTRCLGVBQUEsSUFDQTVCLEtBQUFrQyxpQkFBQSxJQUNBbEMsS0FBQW9DLG1CQUFBLElBQ0FwQyxLQUFBZ0IsdUJBQUEsSUFDQWhCLEtBQUFzRCxXQUFBLGdCQUFBdEQsS0FBQW1CLFFBQUEsT0FDQW5CLEtBQUErQixPQUNBL0IsS0FBQU8sTUFDQVAsS0FBQVMsT0FFQVQsS0FBQVksbUJBQUEsQ0FDQSxDQUFBLElBQUEsSUFBQSxHQUNBLENBQUEsSUFBQSxJQUFBLEtBQ0EsQ0FBQSxHQUFBLElBQUEsSUFDQSxDQUFBLEdBQUEsR0FBQSxLQUNBLENBQUEsSUFBQSxJQUFBLElBQ0EsQ0FBQSxJQUFBLEdBQUEsSUFFQVosS0FBQTZFLFFBQUEsQ0FBQSxHQUFBLEdBQUEsSUFDQTdFLEtBQUEwQyxtQkFBQSxHQUNBMUMsS0FBQW9FLGVBQ0FwRSxLQUFBK0MsV0FBQSxHQUNBL0MsS0FBQTRDLE9BQUEsRUFDQTVDLEtBQUFpRCxjQUFBLEVBQUFqRCxLQUFBZ0IsdUJBQ0FoQixLQUFBMkMsWUFBQTNDLEtBQUFnQiIsImZpbGUiOiJzdGFycnktbmlnaHQubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiY2xhc3MgU3RhciB7XG4gICAgY29uc3RydWN0b3IoaGVpZ2h0KSB7XG4gICAgICAgIGNvbnN0IHR5cGUgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBTdGFyLnR5cGVzKTtcbiAgICAgICAgY29uc3QgY29sb3IgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBTdGFyLmNvbG9ycyk7XG4gICAgICAgIHRoaXMuaW1nQ29sb3IgPSBTdGFyLnNwcml0ZVJlcGxhY2VtZW50c1tjb2xvcl07XG4gICAgICAgIHRoaXMueCA9IE1hdGgucmFuZG9tKCk7XG4gICAgICAgIGlmICh0eXBlb2YgaGVpZ2h0ID09PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgICAgICB0aGlzLnRvQmVSZXBsYWNlZCA9IHRydWU7IC8vIG9ubHkgcmVwbGFjZSBpbml0aWFsIHBvcHVsYXRpb25cbiAgICAgICAgICAgIHRoaXMueSA9IE1hdGgucmFuZG9tKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnkgPSBoZWlnaHQgKyBNYXRoLnJhbmRvbSgpICpcbiAgICAgICAgICAgICAgICBTdGFyLnN0b3BSZW5kZXJpbmdUaHJlc2hvbGQgLSBTdGFyLnN0b3BSZW5kZXJpbmdUaHJlc2hvbGQgLyAyO1xuICAgICAgICAgICAgdGhpcy50b0JlUmVwbGFjZWQgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnogPSAxICsgTWF0aC5yYW5kb20oKSAqIDU7IC8vIGZvciBwYXJhbGxheCBzY3JvbGxpbmdcbiAgICAgICAgdGhpcy5zcHJpdGVYID0gdHlwZSAqIFN0YXIuaW1nU2l6ZTtcbiAgICAgICAgdGhpcy5zcHJpdGVZID0gY29sb3IgKiBTdGFyLmltZ1NpemU7XG4gICAgICAgIHRoaXMuYnJpZ2h0bmVzcyA9IDA7XG4gICAgICAgIC8vIGRpZmZlcmVudCBzdGFydHMgZm9yIGluZGl2aWR1YWwgc3RhcnNcbiAgICAgICAgdGhpcy5ub2lzZVggPSBNYXRoLnJhbmRvbSgpICogMTA7XG4gICAgICAgIHRoaXMubm9pc2VTcGVlZCA9IDAuMDEgKyBNYXRoLnJhbmRvbSgpICogMC4wMzU7XG4gICAgICAgIHRoaXMuZGlzcGxheURpbWVuc2lvbnMgPSBTdGFyLmltZ1NpemUgLyB0aGlzLno7XG4gICAgfVxuXG4gICAgc2hvdyh3LCBoKSB7XG4gICAgICAgIGlmICh0aGlzLnkgPCAtMTAgfHwgdGhpcy55ICsgMTAgPiB3aW5kb3dIZWlnaHQpIHJldHVybjtcbiAgICAgICAgLy8gb25seSByZW5kZXIgcGljdHVyZXMgaWYgd2UgYWJzb2x1dGVseSBuZWVkIHRvOlxuICAgICAgICBpZiAodGhpcy5kaXNwbGF5RGltZW5zaW9ucyA+PSBTdGFyLmltYWdlVGhyZXNob2xkKSB7XG4gICAgICAgICAgICAvLyByZW5kZXIgYXMgaW1hZ2VcbiAgICAgICAgICAgIHRpbnQoMjU1LCB0aGlzLmJyaWdodG5lc3MpO1xuICAgICAgICAgICAgaW1hZ2UoU3Rhci5zcHJpdGUsXG4gICAgICAgICAgICAgICAgdGhpcy54ICogdywgdGhpcy55ICogaCxcbiAgICAgICAgICAgICAgICB0aGlzLmRpc3BsYXlEaW1lbnNpb25zLCB0aGlzLmRpc3BsYXlEaW1lbnNpb25zLFxuICAgICAgICAgICAgICAgIHRoaXMuc3ByaXRlWCwgdGhpcy5zcHJpdGVZLFxuICAgICAgICAgICAgICAgIFN0YXIuaW1nU2l6ZSwgU3Rhci5pbWdTaXplXG4gICAgICAgICAgICApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZmlsbCh0aGlzLmltZ0NvbG9yWzBdLCB0aGlzLmltZ0NvbG9yWzFdLCB0aGlzLmltZ0NvbG9yWzJdLFxuICAgICAgICAgICAgICAgIHRoaXMuYnJpZ2h0bmVzcyk7XG4gICAgICAgICAgICBub1N0cm9rZSgpO1xuICAgICAgICAgICAgaWYgKHRoaXMuZGlzcGxheURpbWVuc2lvbnMgPj0gU3Rhci5lbGxpcHNlVGhyZXNob2xkKSB7XG4gICAgICAgICAgICAgICAgLy8gcmVuZGVyIGFzIGVsbGlwc2VcbiAgICAgICAgICAgICAgICBlbGxpcHNlKFxuICAgICAgICAgICAgICAgICAgICB0aGlzLnggKiB3LCB0aGlzLnkgKiBoLFxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRpc3BsYXlEaW1lbnNpb25zLCB0aGlzLmRpc3BsYXlEaW1lbnNpb25zXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5kaXNwbGF5RGltZW5zaW9ucyA+PSBTdGFyLnJlY3RhbmdsZVRocmVzaG9sZCkge1xuICAgICAgICAgICAgICAgIC8vIHJlbmRlciBhcyByZWN0YW5nbGVcbiAgICAgICAgICAgICAgICByZWN0KFxuICAgICAgICAgICAgICAgICAgICB0aGlzLnggKiB3LCB0aGlzLnkgKiBoLFxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRpc3BsYXlEaW1lbnNpb25zLCB0aGlzLmRpc3BsYXlEaW1lbnNpb25zXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gcmVuZGVyIGFzIHNpbmdsZSBwb2ludFxuICAgICAgICAgICAgICAgIHN0cm9rZSh0aGlzLmltZ0NvbG9yWzBdLCB0aGlzLmltZ0NvbG9yWzFdLCB0aGlzLmltZ0NvbG9yWzJdLFxuICAgICAgICAgICAgICAgICAgICB0aGlzLmJyaWdodG5lc3MpO1xuICAgICAgICAgICAgICAgIHBvaW50KHRoaXMueCAqIHcsIHRoaXMueSAqIGgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICB9XG5cbiAgICB1cGRhdGUoKSB7XG4gICAgICAgIHRoaXMubm9pc2VYICs9IHRoaXMubm9pc2VTcGVlZDtcbiAgICAgICAgdGhpcy5icmlnaHRuZXNzID0gbm9pc2UodGhpcy5ub2lzZVgpICogMjU1O1xuICAgIH1cblxuICAgIHVwZGF0ZVBvc2l0aW9uUG9zdFNjcm9sbChyZWxhdGl2ZUluY3JlYXNlKSB7XG4gICAgICAgIHRoaXMueSAtPSByZWxhdGl2ZUluY3JlYXNlICogU3Rhci5wYXJhbGxheE11bHRpcGxpZXIgLyB0aGlzLno7XG4gICAgICAgIGlmICghdGhpcy50b0JlUmVwbGFjZWQpIHJldHVybjtcbiAgICAgICAgaWYgKHRoaXMueSA8IFN0YXIuU0NSRUVOX1RPUCkge1xuICAgICAgICAgICAgaWYgKFN0YXIuREVCVUcpIGNvbnNvbGUuaW5mbyhcImFkZGluZyBuZXcgc3RhciBhdCBib3R0b21cIik7XG4gICAgICAgICAgICBTdGFyLnBvcHVsYXRpb24ucHVzaChuZXcgU3RhcihTdGFyLlNDUkVFTl9CT1RUT00pKTtcbiAgICAgICAgICAgIHRoaXMudG9CZVJlcGxhY2VkID0gZmFsc2U7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy55ID4gU3Rhci5TQ1JFRU5fQk9UVE9NKSB7XG4gICAgICAgICAgICBpZiAoU3Rhci5ERUJVRykgY29uc29sZS5pbmZvKFwiYWRkaW5nIG5ldyBzdGFyIGF0IHRvcFwiKTtcbiAgICAgICAgICAgIFN0YXIucG9wdWxhdGlvbi5wdXNoKG5ldyBTdGFyKFN0YXIuU0NSRUVOX1RPUCkpO1xuICAgICAgICAgICAgdGhpcy50b0JlUmVwbGFjZWQgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuLy8gZGltZW5zaW9ucyBvZiBhbiBpbmRpdmlkdWFsIHN0YXIgaW1hZ2UgaW4gc3RhcnMtc3ByaXRlLnBuZ1xuU3Rhci5pbWdTaXplID0gMTI7XG4vLyBkZWNpZGUgaG93IHRvIHJlbmRlciBhIHN0YXIgYmFzZWQgb24gdGhlc2UgbWluaW11bSBkaW1lbnNpb24gcmVxdWlyZW1lbnRzXG5TdGFyLmltYWdlVGhyZXNob2xkID0gNC41O1xuU3Rhci5lbGxpcHNlVGhyZXNob2xkID0gMi4yO1xuU3Rhci5yZWN0YW5nbGVUaHJlc2hvbGQgPSAxLjU7XG5TdGFyLnN0b3BSZW5kZXJpbmdUaHJlc2hvbGQgPSAwLjAyO1xuU3Rhci5zcHJpdGVQYXRoID0gXCJzdGFycy1zcHJpdGUtXCIgKyBTdGFyLmltZ1NpemUgKyBcIi5wbmdcIjtcblN0YXIuc3ByaXRlO1xuU3Rhci50eXBlcztcblN0YXIuY29sb3JzO1xuLy8gZXN0aW1hdGVkIGNoYXJhY3RlcmlzdGljIGNvbG9yIGZvciBlYWNoIHJlc3BlY3RpdmUgc3RhciBjb2xvclxuU3Rhci5zcHJpdGVSZXBsYWNlbWVudHMgPSBbXG4gICAgWzIzMiwgMTc1LCA0XSxcbiAgICBbMTk4LCAxMjUsIDE4NF0sXG4gICAgWzY0LCAyMTQsIDUxXSxcbiAgICBbNzQsIDk3LCAxOTFdLFxuICAgIFsyMTQsIDE2NCwgNjRdLFxuICAgIFsyMjQsIDc0LCA0XVxuXTtcblN0YXIuYmdDb2xvciA9IFsyMiwgMjYsIDI5XTtcblN0YXIucGFyYWxsYXhNdWx0aXBsaWVyID0gMC4yO1xuU3Rhci5wb3B1bGF0aW9uU2l6ZTtcblN0YXIucG9wdWxhdGlvbiA9IFtdO1xuU3Rhci5ERUJVRyA9IGZhbHNlO1xuU3Rhci5TQ1JFRU5fQk9UVE9NID0gMSArIFN0YXIuc3RvcFJlbmRlcmluZ1RocmVzaG9sZDtcblN0YXIuU0NSRUVOX1RPUCA9IC1TdGFyLnN0b3BSZW5kZXJpbmdUaHJlc2hvbGQ7XG4iLCJsZXQgY2FudmFzO1xubGV0IGRvY3VtZW50U2Nyb2xsUG9zaXRpb247XG5cbmZ1bmN0aW9uIHByZWxvYWQoKSB7XG4gICAgU3Rhci5zcHJpdGUgPSBsb2FkSW1hZ2UoU3Rhci5zcHJpdGVQYXRoKTtcbn1cblxuZnVuY3Rpb24gc2V0dXAoKSB7XG4gICAgLy8gc2V0IHVwIGNhbnZhcyBmb3IgcDUuanNcbiAgICBjYW52YXMgPSBjcmVhdGVDYW52YXMod2luZG93V2lkdGgsIHdpbmRvd0hlaWdodCk7XG4gICAgLy8gY2FudmFzLnBvc2l0aW9uKDAsIDApO1xuICAgIGNhbnZhcy5lbHQuc3R5bGUuekluZGV4ID0gXCItMVwiO1xuICAgIGNhbnZhcy5lbHQuc3R5bGUucG9zaXRpb24gPSBcImZpeGVkXCI7XG4gICAgY2FudmFzLmVsdC5zdHlsZS5sZWZ0ID0gXCIwXCI7XG4gICAgY2FudmFzLmVsdC5zdHlsZS50b3AgPSBcIjBcIjtcbiAgICBlbGxpcHNlTW9kZShDT1JORVIpO1xuICAgIC8vIGhhbmRsZSBzcHJpdGVcbiAgICBTdGFyLnNwcml0ZS5sb2FkUGl4ZWxzKCk7XG4gICAgU3Rhci50eXBlcyA9IE1hdGguZmxvb3IoU3Rhci5zcHJpdGUud2lkdGggLyBTdGFyLmltZ1NpemUpO1xuICAgIFN0YXIuY29sb3JzID0gTWF0aC5mbG9vcihTdGFyLnNwcml0ZS5oZWlnaHQgLyBTdGFyLmltZ1NpemUpO1xuICAgIC8vIGNyZWF0ZSBzdGFyc1xuICAgIFN0YXIucG9wdWxhdGlvblNpemUgPSB3aW5kb3dXaWR0aCAqIHdpbmRvd0hlaWdodCAvIDE0MDAwO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgU3Rhci5wb3B1bGF0aW9uU2l6ZTsgaSsrKVxuICAgICAgICBTdGFyLnBvcHVsYXRpb24ucHVzaChuZXcgU3RhcigpKTtcbiAgICAvLyBoYW5kbGUgcGFyYWxsYXggc2Nyb2xsaW5nXG4gICAgZG9jdW1lbnRTY3JvbGxQb3NpdGlvbiA9IGdldFNjcm9sbFBvc2l0aW9uKCk7XG4gICAgd2luZG93Lm9uc2Nyb2xsID0gaGFuZGxlU3RhcnJ5TmlnaHRTY3JvbGw7XG4gICAgLyogKG5lYXJseSkgYWxsIGRldmljZXMgd2lsbCBiZSBhYmxlIHRvIGhhbmRsZSAzNSBmcHMsIHNvIHNldHRpbmcgdGhpc1xuICAgICAqIGFzIHRoZSBtYXhpbXVtIGZwcyBlbnN1cmVzIHNpbWlsYXIgbG9va2luZyBmbGlja2VyaW5nIG9uIGRpZmZlcmVudFxuICAgICAqIGRldmljZXNcbiAgICAgKi9cbiAgICBmcmFtZVJhdGUoMzUpO1xufVxuXG5mdW5jdGlvbiBkcmF3KCkge1xuICAgIGNvbnN0IHcgPSB3aW5kb3dXaWR0aDtcbiAgICBjb25zdCBoID0gd2luZG93SGVpZ2h0O1xuICAgIGJhY2tncm91bmQoU3Rhci5iZ0NvbG9yWzBdLCBTdGFyLmJnQ29sb3JbMV0sIFN0YXIuYmdDb2xvclsyXSk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBTdGFyLnBvcHVsYXRpb24ubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgU3Rhci5wb3B1bGF0aW9uW2ldLnVwZGF0ZSgpO1xuICAgICAgICBTdGFyLnBvcHVsYXRpb25baV0uc2hvdyh3LCBoKTtcbiAgICB9XG4gICAgaWYgKFN0YXIuREVCVUcpIHtcbiAgICAgICAgZmlsbCgyNTUpO1xuICAgICAgICB0ZXh0U2l6ZSgzMik7XG4gICAgICAgIHRleHQoTWF0aC5yb3VuZChmcmFtZVJhdGUoKSksIDEwLCA1MCk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiB3aW5kb3dSZXNpemVkKCkge1xuICAgIHJlc2l6ZUNhbnZhcyh3aW5kb3dXaWR0aCwgd2luZG93SGVpZ2h0KTtcbn1cblxuZnVuY3Rpb24gZ2V0U2Nyb2xsUG9zaXRpb24oKSB7XG4gICAgcmV0dXJuIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3AgfHwgZG9jdW1lbnQuYm9keS5zY3JvbGxUb3A7XG59XG5cbmZ1bmN0aW9uIGhhbmRsZVN0YXJyeU5pZ2h0U2Nyb2xsKCkge1xuICAgIGNvbnN0IG5ld1Njcm9sbFBvc2l0aW9uID0gZ2V0U2Nyb2xsUG9zaXRpb24oKTtcbiAgICBjb25zdCByZWxhdGl2ZUluY3JlYXNlID0gKG5ld1Njcm9sbFBvc2l0aW9uIC0gZG9jdW1lbnRTY3JvbGxQb3NpdGlvbikgLyB3aW5kb3dIZWlnaHQ7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBTdGFyLnBvcHVsYXRpb24ubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgU3Rhci5wb3B1bGF0aW9uW2ldLnVwZGF0ZVBvc2l0aW9uUG9zdFNjcm9sbChyZWxhdGl2ZUluY3JlYXNlKTtcbiAgICB9XG4gICAgZG9jdW1lbnRTY3JvbGxQb3NpdGlvbiA9IG5ld1Njcm9sbFBvc2l0aW9uO1xufVxuIl19
